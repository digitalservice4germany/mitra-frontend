var Q=Object.defineProperty;var R=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var j=(t,e,r)=>e in t?Q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,c=(t,e)=>{for(var r in e||(e={}))X.call(e,r)&&j(t,r,e[r]);if(R)for(var r of R(e))Z.call(e,r)&&j(t,r,e[r]);return t};var o=(t,e,r)=>(j(t,typeof e!="symbol"?e+"":e,r),r),q=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)};var C=(t,e,r)=>(q(t,e,"read from private field"),r?r.call(t):e.get(t)),z=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},N=(t,e,r,s)=>(q(t,e,"write to private field"),s?s.call(t,r):e.set(t,r),r);import{a as B}from"./main.b9b3e398.js";import{E as I,C as _}from"./Contract.6e826346.js";class ee{constructor(e){this.storage=e}async load(e){return this.storage.load(e)}async save(e){return this.storage.save(e)}}class te{constructor(e){this.storage=e}async load(e){return this.storage.load(e)}async save(e){return this.storage.save(e)}}function f(t){return t.title.toLowerCase().replace(/\s/g,"-")}async function V(t,e){const r=await t.createWritable();await r.write(e),await r.close()}var L={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Object.prototype.hasOwnProperty;t.is=function(r,s){return r===s?r!==0||s!==0||1/r===1/s:r!==r&&s!==s},t.shallowEqual=function(r,s,a){if(r===s)return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var n=Object.keys(r),i=Object.keys(s);if(n.length!==i.length)return!1;for(var K=a&&typeof a.customEqual=="function"?a.customEqual:t.is,k=0;k<n.length;k++){var M=n[k];if(!e.call(s,M)||!K(r[M],s[M]))return!1}return!0}})(L);class re{equals(e){return e==null?!1:L.shallowEqual(this,e)}}class b{constructor(e,r){this.text=e,this.path=r}clone(){return new b(this.text,this.path.map(e=>e.clone()))}}class h extends re{constructor(e){super();this.value=e,this.value=e}setValue(e){this.value=e}}class p extends h{constructor(e=""){super(e)}clone(){return new p(this.value)}toString(){return this.value}}class Y extends h{constructor(e=""){super(e)}clone(){return new p(this.value)}toString(){return this.value}}class u extends h{constructor(e,r=-1){super(r);this.choices=e}clone(){return new u(this.choices.map(e=>e.clone()),this.value)}get selected(){return this.choices[this.value]}toString(){var e;return`${((e=this.selected)==null?void 0:e.text)||""}`}}class l extends h{constructor(e,r=[]){super(r);this.choices=e,this.value=r}clone(){return new l(this.choices.map(e=>e.clone()),this.value)}get selected(){return this.value.sort().reduce((e,r)=>[...e,this.choices[r]],[])}toString(){return`${this.selected.map(e=>e.text).join(", ")}`}}class O extends h{constructor(e){super(e)}clone(){return new O(this.value)}toString(){return JSON.stringify(this.value)}}class J extends I{constructor(e="Unbenanntes Modul",r=[],s){super(s);this.title=e,this.steps=r}get path(){return Object.freeze(this.steps.flatMap(e=>e.path))}clone(){return new J(this.title,this.steps.map(e=>e.clone()))}addStep(e,r){r||(r=this.steps.length),this.steps.splice(r,0,e)}duplicateStep(e){if(!this.steps.includes(e))throw new Error("step not in module");const r=e.clone();r.prompt=`Kopie von ${e.prompt}`,this.addStep(r,this.steps.indexOf(e)+1)}removeStep(e){this.steps=this.steps.filter(r=>r!==e)}}var d;class se extends I{constructor(e="Unbenanntes Playbook",r=[],s){super(s);z(this,d,void 0);this.title=e,this.modules=r,N(this,d,{createdAt:new Date}),Object.defineProperty(this,"metadata",{get:()=>C(this,d)})}updateMetadata(e){return N(this,d,c(c({},C(this,d)),e)),this}addModules(...e){this.modules.push(...e)}removeModule(e){this.modules=this.modules.filter(r=>!r.equals(e))}findModuleById(e){const r=this.modules.find(s=>s.id===e);if(r===void 0)throw new Error("Module not found");return r}}d=new WeakMap;const D=t=>{const e=[t],{selected:r}=t;return[r!=null?r:[]].flat().flatMap(s=>s.path).forEach(s=>e.push(...D(s))),Object.freeze(e)};class w extends I{constructor(e,r,s,a){super(a);this.prompt=e,this.answer=r,this.description=s;for(const n of["type"]){const i=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(this),n);Object.defineProperty(this,n,Object.assign(i,{enumerable:!0}))}}get path(){return Object.freeze([this])}print(){return this.answer.toString()}}const A=class extends w{constructor(e,{answer:r=new p,produce:s="${answer}",description:a,id:n}={}){super(e,r,a,n);o(this,"produce");this.produce=s}get type(){return A.TYPE}print(){return this.answer.value?this.produce.replaceAll("${answer}",this.answer.value):""}clone(){return new A(this.prompt,{answer:new p(this.answer.value),produce:this.produce,description:this.description})}};let m=A;o(m,"TYPE","TextAnswerStep");const P=class extends w{constructor(e,{answer:r=new Y,produce:s="${answer}",description:a,id:n}={}){super(e,r,a,n);o(this,"produce");this.produce=s}get type(){return P.TYPE}print(){return this.answer.value?this.produce.replaceAll("${answer}",this.answer.value):""}clone(){return new P(this.prompt,{answer:new Y(this.answer.value),produce:this.produce,description:this.description})}};let S=P;o(S,"TYPE","RichTextAnswerStep");const T=class extends w{constructor(e,{answer:r=new u([]),description:s,id:a}={}){super(e,r,s,a)}get type(){return T.TYPE}get path(){return D(this)}get choices(){return this.answer.choices}get selected(){return this.answer.selected}clone(){return new T(this.prompt,{answer:new u(this.choices.map(e=>e.clone()),this.answer.value),description:this.description})}};let y=T;o(y,"TYPE","SingleChoiceAnswerStep");const x=class extends w{constructor(e,{answer:r=new l([]),description:s,id:a}={}){super(e,r,s,a)}get type(){return x.TYPE}get path(){return D(this)}get choices(){return this.answer.choices}get selected(){return this.answer.selected}clone(){return new x(this.prompt,{answer:new l(this.choices.map(e=>e.clone()),this.answer.value),description:this.description})}};let v=x;o(v,"TYPE","MultipleChoiceAnswerStep");const E=class extends w{constructor(e,r,{produce:s="${answer}",description:a,id:n}={}){super(e,r,a,n);o(this,"produce");this.produce=s}get type(){return E.TYPE}clone(){return new E(this.prompt,new O(this.answer.value),{produce:this.produce,description:this.description})}updateCell(e,r,s){this.answer.value[e][r]=s}};let g=E;o(g,"TYPE","SheetAnswerStep");function $(t){if(t.type===m.TYPE){const e=t.answer;return new m(t.prompt,{answer:new p(e.value),produce:t.produce,description:t.description,id:t.id})}if(t.type===S.TYPE){const e=t.answer;return new S(t.prompt,{answer:new Y(e.value),produce:t.produce,description:t.description,id:t.id})}if(t.type===y.TYPE){const e=t.answer;return new y(t.prompt,{answer:new u(e.choices.map(r=>new b(r.text,r.path.map($))),e.value),description:t.description,id:t.id})}if(t.type===v.TYPE){const e=t.answer;return new v(t.prompt,{answer:new l(e.choices.map(r=>new b(r.text,r.path.map($))),e.value),description:t.description,id:t.id})}if(t.type===g.TYPE){const e=t.answer;return new g(t.prompt,new O(e.value),{produce:t.produce,description:t.description,id:t.id})}throw console.error("Step type unknown, cannot deserialize JSON",t),new Error("Step type unknown")}function W(t){return new J(t.title,t.steps.map($),t.id)}function G({contract:t}){return new _(t.title,t.modules.map(W),t.id)}function F({playbook:t}){return new se(t.title,t.modules.map(W),t.id)}async function H(t){const e=new FileReader;return e.readAsText(t),await new Promise(r=>{e.onload=()=>{r(e.result)}})}const ae={async load(t){const e=JSON.parse(await H(t));return G(e).updateMetadata({createdAt:new Date(e.createdAt),savedAt:new Date(t.lastModified)})},async save(t){const e=JSON.stringify(c({contract:t},t.metadata));if(window.showSaveFilePicker){const r=await window.showSaveFilePicker({suggestedName:f(t),startIn:"desktop",types:[{accept:{"application/json":[".json"]}}]});await V(r,e)}else await B(()=>import("./FileSaver.min.297e5979.js").then(function(r){return r.F}),[]).then(({default:r})=>{const s=new Blob([e],{type:"application/json;charset=utf-8"});r.saveAs(s,`${f(t)}.json`)})}},ne={findById(t){const e=localStorage.getItem(t);if(e===null)throw new Error("Contract not found");const r=JSON.parse(e,(n,i)=>["createdAt","savedAt"].includes(n)?new Date(i):i),{createdAt:s,savedAt:a}=r;return G(r).updateMetadata({createdAt:s,savedAt:a})},save(t){localStorage.setItem(t.id,JSON.stringify(c({contract:t},t.metadata)))}},ie={id:"db2a1d38-01fb-4ea2-bc6f-b5213413c809",title:"EVB-IT Cloud",modules:[{id:"0b141639-8718-4ad9-9839-ec89aa8a1ec4",title:"Rubrum",steps:[{id:"06817a49-dd7b-4d8a-9c5b-77702e913a30",prompt:"Schritt 1.1",type:"TextAnswerStep",answer:{},produce:"Textbaustein: ${answer}"},{id:"c22cb3a2-2f89-47eb-b90c-a11f427ca6c8",prompt:"Schritt 1.2",type:"TextAnswerStep",answer:{}},{id:"f7e2bb12-ba14-4686-8513-afbdcab276a8",prompt:"Schritt 1.3",type:"SingleChoiceAnswerStep",answer:{choices:[{text:"Auswahl A",path:[{id:"57c97b0d-4eae-439e-b747-c297b76128e5",prompt:"Schritt 1.3 A",type:"TextAnswerStep",answer:{}}]},{text:"Auswahl B",path:[{id:"0b79fbb8-18f4-4824-af2a-3f4a95dc8cc6",prompt:"Schritt 1.3 B",type:"TextAnswerStep",answer:{}}]}]}},{id:"f7e2bb12-ba14-4686-8513-afbdcab276a8",prompt:"Schritt 1.4",type:"MultipleChoiceAnswerStep",answer:{choices:[{text:"Auswahl 1",path:[{id:"57c97b0d-4eae-439e-b747-c297b76128e5",prompt:"Schritt 1.4 1",type:"TextAnswerStep",answer:{}}]},{text:"Auswahl 2",path:[{id:"0b79fbb8-18f4-4824-af2a-3f4a95dc8cc6",prompt:"Schritt 1.4 2",type:"TextAnswerStep",answer:{}}]}]}},{id:"5ee3e9de-5052-49ac-95ed-849df72a7167",prompt:"Schritt 1.5",type:"RichTextAnswerStep",answer:{},produce:"Textbaustein: ${answer}"},{id:"5ee3e9de-5052-49ac-95ed-849df72a7167",prompt:"Schritt 1.6",type:"RichTextAnswerStep",answer:{}},{id:"c22cb3a2-2f89-47eb-b90c-a11f427ca6c8",prompt:"Schritt 1.7",type:"SheetAnswerStep",answer:{value:[{"Lfd Nr":"1","Produkt/ Leistung":"Amazon Web Services",Menge:"1",MVD:"Juni '22",Beginn:"01.01.22","Monatlicher Preis":"3989,86\u20AC"}]}}]},{id:"2407b57d-dfb2-487e-a4b2-d9f6f720cebe",title:"Gegenstand und Bestandteile des Vertrags",steps:[{id:"203e3a8f-e8c7-45b7-86e7-e6390393a348",prompt:"Schritt 2.1",type:"TextAnswerStep",answer:{}},{id:"0b570aab-fa1b-4d93-aab3-35250b8590dc",prompt:"Schritt 2.2",type:"TextAnswerStep",answer:{}},{id:"c8a04406-bba5-4968-bf2a-54122f58fbc3",prompt:"Schritt 2.3",type:"TextAnswerStep",answer:{}}]},{id:"d00fdd08-805a-4c11-8e19-c57ca770f09f",title:"Gegenstand der Leistungen",steps:[{id:"28acb64b-2c87-44c2-a112-10128a1ca546",prompt:"Schritt 3.1",type:"TextAnswerStep",answer:{}},{id:"3f460bf7-305f-4d53-a01b-074aa148c179",prompt:"Schritt 3.2",type:"TextAnswerStep",answer:{}},{id:"3cd87b83-60fa-4fd3-953b-fb0ad6d57a46",prompt:"Schritt 3.3",type:"TextAnswerStep",answer:{}},{id:"253a3dcf-9731-4537-8be3-908ec0e0c887",prompt:"Schritt 3.4",type:"TextAnswerStep",answer:{}}]}]};var oe={playbook:ie};const U={findById(t){const e=localStorage.getItem(t);if(e===null)throw new Error("Playbook not found");const r=JSON.parse(e,(n,i)=>["createdAt","savedAt"].includes(n)?new Date(i):i),{createdAt:s,savedAt:a}=r;return F(JSON.parse(e)).updateMetadata({createdAt:s,savedAt:a})},save(t){localStorage.setItem(t.id,JSON.stringify(c({playbook:t},t.metadata)))}},ce=F(oe);U.save(ce);const de={async load(t){const e=JSON.parse(await H(t));return F(e).updateMetadata({createdAt:new Date(e.createdAt),savedAt:new Date(t.lastModified)})},async save(t){const e=JSON.stringify(c({playbook:t},t.metadata));if(window.showSaveFilePicker){const r=await window.showSaveFilePicker({suggestedName:f(t),startIn:"desktop",types:[{accept:{"application/json":[".json"]}}]});await V(r,e)}else await B(()=>import("./FileSaver.min.297e5979.js").then(function(r){return r.F}),[]).then(({default:r})=>{const s=new Blob([e],{type:"application/json;charset=utf-8"});r.saveAs(s,`${f(t)}.json`)})}},he=()=>ne,we=()=>U,fe=()=>new ee(ae),be=()=>new te(de);export{v as M,se as P,S as R,y as S,m as T,g as a,fe as b,we as c,be as d,J as e,he as m};
